id: io.neovim.nvim.tool.tmux
build-extension: true
sdk: org.freedesktop.Sdk//22.08
runtime: io.neovim.nvim
runtime-version: stable
branch: stable
separate-locales: false
appstream-compose: false
build-options:
  prefix: /app/tools/tmux
  prepend-pkg-config-path: /app/tools/tmux/lib/pkgconfig
  ldflags: -L/app/tools/tmux/lib
  cflags: -I/app/tools/tmux/include
modules:
  - name: libevent
    buildsystem: autotools 
    config-opts:
      - --enable-shared
    sources:
      - type: archive
        url: https://github.com/libevent/libevent/releases/download/release-2.1.12-stable/libevent-2.1.12-stable.tar.gz
        sha256: 92e6de1be9ec176428fd2367677e61ceffc2ee1cb119035037a27d346b0403bb
  - name: libutempter
    buildsystem: simple
    subdir: libutempter
    build-commands:
      - make libdir=${FLATPAK_DEST}/lib libexecdir=${FLATPAK_DEST}/lib includedir=${FLATPAK_DEST}/include mandir=${FLATPAK_DEST}/share/man
      - make libdir=${FLATPAK_DEST}/lib libexecdir=${FLATPAK_DEST}/lib includedir=${FLATPAK_DEST}/include mandir=${FLATPAK_DEST}/share/man install
    sources:
      - type: archive
        url: https://github.com/altlinux/libutempter/archive/refs/tags/1.2.1-alt1.tar.gz 
        sha256: 258d8bc4a42d2cbe4df6415912ab842574899adddbfc89d14ab56b57bb81158b 
  - name: tmux
    buildsystem: autotools 
    config-opts:
      - --enable-utempter
    post-install:
      - install -Dm755 tmux-wrapper.sh /app/tools/tmux/bin/tmux-wrapper.sh
      - install -Dm644 -t $FLATPAK_DEST/share/metainfo $FLATPAK_ID.metainfo.xml
      - appstream-compose --basename=$FLATPAK_ID --prefix=$FLATPAK_DEST --origin=flatpak
        $FLATPAK_ID    
    sources:
      - type: archive
        url: https://github.com/tmux/tmux/releases/download/3.3a/tmux-3.3a.tar.gz
        sha256: e4fd347843bd0772c4f48d6dde625b0b109b7a380ff15db21e97c11a4dcdf93f
      - type: file
        path: tmux-wrapper.sh
      - type: file
        path: io.neovim.nvim.tool.tmux.metainfo.xml
