app-id: io.neovim.nvim.tool.tmux
branch: stable
runtime: io.neovim.nvim
runtime-version: stable
sdk: org.freedesktop.Sdk//22.08
build-extension: true
separate-locales: false

modules:
  - name: libevent
    sources:
      - type: archive
        url: https://github.com/libevent/libevent/releases/download/release-2.1.12-stable/libevent-2.1.12-stable.tar.gz
        sha256: 92e6de1be9ec176428fd2367677e61ceffc2ee1cb119035037a27d346b0403bb
    buildsystem: simple
    build-commands:
      - ./configure --prefix=${FLATPAK_DEST}
      - make
      - make install
  - name: libutempter
    sources:
      - type: archive
        url: https://github.com/altlinux/libutempter/archive/refs/tags/1.2.1-alt1.tar.gz 
        sha256: 258d8bc4a42d2cbe4df6415912ab842574899adddbfc89d14ab56b57bb81158b 
    buildsystem: simple
    build-commands:
      - make -C libutempter DESTDIR=${FLATPAK_DEST}
      - make -C libutempter DESTDIR=${FLATPAK_DEST} install
  - name: tmux
    sources:
      - type: archive
        url: https://github.com/tmux/tmux/releases/download/3.3a/tmux-3.3a.tar.gz
        sha256: e4fd347843bd0772c4f48d6dde625b0b109b7a380ff15db21e97c11a4dcdf93f
      - type: file
        path: tmux-wrapper.sh
    buildsystem: simple
    build-commands:
      - ./configure --prefix=${FLATPAK_DEST} PKG_CONFIG_PATH=${FLATPAK_DEST}/lib/pkgconfig LDFLAGS=-L${FLATPAK_DEST}/lib
      # - ./configure --prefix=${FLATPAK_DEST} --enable-utempter 
      - make
      - make install
post-install:
  - install -Dm644 -t /app/share/metainfo io.neovim.nvim.tool.tmux.metadata.xml
  - install -Dm755 /app/bin/tmux tmux-wrapper.sh
  - chmod +x /app/bin/tmux
metadata:
  - io.neovim.nvim.tool.tmux.metadata.xml
